{% extends '_base.html' %}
{% load static %}
{% load crispy_forms_tags %}


{% block title %}Birds{% endblock title %}

{% block content %}
<!-- bird picture div -->
<div class="row">
  <div class="container">
    <hr class="featurette-divider">
    <img class="bird_detail_image" src="{{bird_detail.picture.url}}" data-src="{holder.js/500x500/auto}" alt="Picture not found">

  </div>
    <!-- <img class="bird_detail_image" src="{{bird_detail.picture.url}}" data-src="{holder.js/500x500/auto}" alt="Picture not found" > -->

<!-- bird picture div -->
<!-- bird detailed information div -->

  <div class="col-12">
            <hr class="featurette-divider">
                  <div class="row featurette">
                    <div class="col-md-12 order-md-2" align=center>
                      <h4 class="featurette-heading">Species: <span class="text-muted">{{bird_detail.species}}</span></h4>
                      <h4 class="featurette-heading">Location: <span class="text-muted">{{bird_detail.location}}</span></h4>
                      <h4 class="featurette-heading">Photographer: 
                          <span class="text-muted">
                            <a href="{% url 'profile_detail' pk=bird_detail.photographer.pk %}">
                                {{bird_detail.photographer|capfirst}}</a>
                            </span></h4>
                            <h4 class="featurette-heading">Photographer comments: <span class="text-muted">{{bird_detail.photographer_comment}}</span></h4>
                        {% if bird_detail.photographer == user %}
                          <a href="{% url 'bird_update' pk=bird_detail.pk %}">
                            <button class="btn btn-info bird_detail_btn">
                              <i class="fas fa-feather-alt"> Edit</i> 
                            </button>
                          </a>
                          <a href="{% url 'bird_delete' pk=bird_detail.pk %}">
                            <button class="btn btn-dark bird_detail_btn">
                              <i class="fas fa-dove"> Remove</i>
                            </button>
                          </a>
                        {% endif %}
                        <!-- seed button only for users other than photographer -->
                        {% if user != bird_detail.photographer %}
                          <a href="{% url 'seed' pk=bird_detail.pk %}">
                            <button class="btn btn-dark bird_detail_btn">
                              <i class="fas fa-seedling"> {{bird_detail.seeds.count}} Seeds</i> 
                            </button>
                          </a>
                        {% else %}
                          <a href="{% url 'seed' pk=bird_detail.pk %}">
                            <button class="btn btn-dark bird_detail_btn" disabled>
                              <i class="fas fa-seedling"> {{bird_detail.seeds.count}} Seeds</i> 
                            </button>
                          </a>
                        {% endif %}
                    </div>
                  </div>
                  <hr class="featurette-divider">
                </div>
        <!-- col ends here -->
  </div>
<!-- bird detailed information div -->
<!-- comment textbox container -->
<div class="container"> 
  <div class="media mt-3 shadow-textarea">
        <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{user.profile_picture.url}}"
          alt="Generic placeholder image">
        <div class="media-body">
          <h5 class="mt-0 font-weight-bold blue-text">Add a comment:</h5>
          <div class="form-group basic-textarea rounded-corners">
            <form method="POST">
              {% csrf_token %}
              {{ comment_form|crispy }}
              <input type="submit" class="btn btn-primary" value="Send your nice comment!">
            </form>
          </div>
        </div>
  </div>
</div>
<!-- comments and replies -->
<div class="container">
<!-- will be displayed if there are comments linked to the bird -->
{% for comment in bird_detail.comments.all %}
  {% if comment.comment_approved %}
    <!-- load approved comments -->
    <hr class="featurette-divider">
    <!-- cycle through colors for comments divs -->
      <div class="media mt-3 px-3 py-3" style="background-color:{% cycle '#faf8f7' '#e1e9f5' '#e6e1f5' '#fffad4' %}; border-radius: 5%">
        <a href="{% url 'profile_detail' pk=comment.comment_creator.pk %}">
            <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{ comment.comment_creator.profile_picture.url }}"
                alt="Avatar">
        </a>
        <div class="media-body">
          <h5 class="mt-0 font-weight-bold blue-text">{{ comment.comment_creator.username|capfirst }} 
          </h5>
          {{ comment.comment }}
          <div align=center class="mt-3 mb-3">
            {% if user == comment.comment_creator %}
                <a href="{% url 'comment_edit' pk=comment.pk %}" class="comment_box_btn btn btn-secondary">
                  Edit
                </a>
            {% endif %} 
            {% if user == bird_detail.photographer or user == comment.comment_creator %}
                <a href="{% url 'comment_removed' pk=comment.pk %}" class="comment_box_btn btn btn-danger">
                  Remove
                </a>
            {% endif %}
          </div>
      </div>
      <div class="row">
        <div class="col-12" align=right>
          <span class="text-muted">Created at: {{ comment.created }}</span>
        </div>
        <div class="col-12" align=right>
          <span class="text-muted">Edited at: {{ comment.modified }}</span>
        </div>
      </div>
    </div>


    <!-- loading the replies -->
{% for reply in comment.replies.all %}
  {% if reply.reply_approved %}
  <!-- load approved replies -->
      <ul class="mb-5">
        <hr class="featurette-divider">
        <!-- cycle through colors for replies divs -->
        <div class="media mt-3 px-3 py-3" style="background-color:{% cycle '#fffad4' '#ffe6d4' '#faf8f7' '#e1e9f5' '#fffad4' %}; border-radius: 5%" >
          <a href="{% url 'profile_detail' pk=reply.reply_creator.pk %}">
            <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{ reply.reply_creator.profile_picture.url }}"
              alt="Avatar">
          </a>
          <div class="media-body">
          <h5 class="mt-0 font-weight-bold blue-text">{{reply.reply_creator|capfirst}}
            </h5>
            {{reply.reply}}
            <div align=center class="mt-3 mb-3">
              {% if user == reply.reply_creator %}
                  <a href="{% url 'reply_edit' pk=reply.pk %}" class="comment_box_btn btn btn-secondary">
                    Edit
                  </a>
              {% endif %} 
              {% if user == bird_detail.photographer or user == reply.reply_creator %}
                  <a href="{% url 'reply_removed' pk=reply.pk %}" class="comment_box_btn btn btn-danger">
                    Remove
                  </a>
              {% endif %}
            </div>
          </div>
          <div class="row">
            <div class="col-12" align=right>
              <span class="text-muted">Created at: {{ comment.created }}</span>
            </div>
            <div class="col-12" align=right>
              <span class="text-muted">Edited at: {{ comment.modified }}</span>
            </div>
          </div>
        </div>
      </ul>
{% else %}

<!-- loads replies not yet approved visible only to photograher and reply creator -->
  {% if user == bird_detail.photographer or user == reply.reply_creator %}
      <ul class="mb-5">
        <hr class="featurette-divider">
        <div class="media mt-3 px-3 py-3" style="background-color:{% cycle '#fffad4' '#ffe6d4' '#faf8f7' '#e1e9f5' '#fffad4' %}; border-radius: 5%" >
          <a href="{% url 'profile_detail' pk=comment.comment_creator.pk %}">
            <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{ reply.reply_creator.profile_picture.url }}"
              alt="Avatar">
          </a>
          <div class="media-body">
          <h5 class="mt-0 font-weight-bold blue-text">{{reply.reply_creator|capfirst}}
            </h5>
            <p class="mt-3" style="color: red;">Reply will be visiable to others only after the photographer approves it.</p>
            {{reply.reply}}
            <div align=center class="mt-3 mb-3">
              {% if user == bird_detail.photographer %}
                <a href="{% url 'reply_approved' pk=reply.pk %}" class="comment_box_btn btn btn-primary">
                  Approve
                </a>
              {% endif %}
              {% if user == reply.reply_creator %}
                <a href="{% url 'reply_edit' pk=reply.pk %}" class="comment_box_btn btn btn-secondary">
                    Edit
                  </a>
              {% endif %}
              {% if user == bird_detail.photographer or user == reply.reply_creator %}
                  <a href="{% url 'reply_removed' pk=reply.pk %}" class="comment_box_btn btn btn-danger">
                    Remove
                  </a>
              {% endif %}
            </div>
          </div>
          <div class="row">
            <div class="col-12" align=right>
              <span class="text-muted">Created at: {{ comment.created }}</span>
            </div>
            <div class="col-12" align=right>
              <span class="text-muted">Edited at: {{ comment.modified }}</span>
            </div>
          </div>
        </div>
      </ul>
  {% endif %}
{% endif %}
<!-- closes replies forloop -->
{% endfor %}

<!-- still inside comment's forloop -->


<!-- loads reply textarea for all comments -->
  <ul class="mb-1" id='reply_box' >
    <hr class="featurette-divider">
    <div class="media mt-3">
      <a href="{% url 'profile_detail' pk=comment.comment_creator.pk %}">
        <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{ user.profile_picture.url }}"
        alt="Avatar">
      </a>
      <div class="media-body">
      <h5 class="mt-0 font-weight-bold blue-text">{{user.username|capfirst}}
        </h5>
        <form action="{% url 'bird_detail' pk=comment.pk %}" method="POST"> {% csrf_token %}
          {{reply_form|crispy}}
          <input type="submit" class="btn btn-primary" value="Send your sweet reply!">
        </form>
      </div>
    </div>
  </ul>



  <!-- if comment is not yet approved it will display the following -->
{% else %}
  <!-- comments will be visiable only to photographer or user who created the comment awaiting approval by photographer. -->
    {% if user == bird_detail.photographer or user == comment.comment_creator %}
        <hr class="featurette-divider">
        <div class="media mt-3 px-3 py-3" style="background-color:{% cycle '#faf8f7' '#e1e9f5' '#e6e1f5' '#fffad4' %}; border-radius: 5%">
            <a href="{% url 'profile_detail' pk=comment.comment_creator.pk %}">
              <img class="d-flex rounded-circle avatar z-depth-1-half mr-3 comment_picture_size" src="{{ comment.comment_creator.profile_picture.url }}"
                alt="Avatar">
            </a>
            <div class="media-body">
            <h5 class="mt-0 font-weight-bold blue-text">{{ comment.comment_creator.username }} 
            </h5>
            <p class="mt-3" style="color: red;">Comment will be visiable to others only after the photographer approves it.</p>
              {{ comment.comment }}
              <div align=center class="mt-3 mb-3">
                {% if user == bird_detail.photographer %}
                    <a href="{% url 'comment_approved' pk=comment.pk %}" class="comment_box_btn btn btn-primary">
                      Approve
                    </a>
                {% endif %}
                  {% if user == comment.comment_creator %}
                  <a href="{% url 'comment_edit' pk=comment.pk %}" class="comment_box_btn btn btn-secondary">
                    Edit
                  </a>
                  {% endif %}
                  {% if user == bird_detail.photographer or user == comment.comment_creator %}
                  <a href="{% url 'comment_removed' pk=comment.pk %}" class="comment_box_btn btn btn-danger">
                    Remove
                  </a>
                {% endif %}
              </div>
            </div>
            <div class="row">
              <div class="col-12" align=right>
                <span class="text-muted">Created at: {{ comment.created }}</span>
              </div>
              <div class="col-12" align=right>
                <span class="text-muted">Edited at: {{ comment.modified }}</span>
              </div>
            </div>
          </div>
      {% endif %}
    {% endif %}
<!-- end of comments forloop -->
{% endfor %}
<!-- ends comment container div -->
</div>
<!-- row ends here -->
</div>
{% endblock content %}